name: Checkov
icon: https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRPsdhUMbF4FBmeun5DtMEN4C-eLcLjteM7ssAA1PBE&s
inputs:
  directory:
    description: The IaC directory you want to scan with Checkov.
    required: true
  flags:
    description: Additional Checkov flags
  checkov_version:
    description: The version of Checkov to install.
    required: false
run:
  exec: |
    START_TIME=$SECONDS
    CHECKOV_VERSION="${inputs.checkov_version}"
    
    if [ -z "$CHECKOV_VERSION" ]; then
      echo -e "\033[1;33mno version specified for checkov. installing latest\033[0m"
      
      test -d ~/.linuxbrew && eval "$(~/.linuxbrew/bin/brew shellenv)"
      test -d /home/linuxbrew/.linuxbrew && eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
      test -r ~/.bash_profile && echo "eval \"\$($(brew --prefix)/bin/brew shellenv)\"" >> ~/.bash_profile
      echo "eval \"\$($(brew --prefix)/bin/brew shellenv)\"" >> ~/.profile
      
      /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
    
      brew install checkov
    else
      echo "installing $CHECKOV_VERSION"
      pip install -U "checkov==$CHECKOV_VERSION"
    fi
    
    ELAPSED_TIME=$(($SECONDS - $START_TIME))
    echo -e "\033[0;32mSUCCESS: installation took \033[1;36m$ELAPSED_TIME\033[0;32m seconds.\033[0m"
    checkov --directory ${inputs.directory} ${inputs.flags}



